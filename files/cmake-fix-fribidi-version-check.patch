From aa6e97246c86e6e7fc556172244df395cc8fa6d4 Mon Sep 17 00:00:00 2001
From: eumagga0x2a <eumagga0x2a@users.noreply.github.com>
Date: Fri, 13 Apr 2018 19:41:31 +0200
Subject: [PATCH] [cmake] Fix fribidi version check, consistently use the
 correct library name

---
 .../ass/ADM_libass/CMakeLists.txt                  |  2 +-
 .../ADM_videoFilters6/ass/CMakeLists.txt           | 16 +++++-----
 cmake/admCheckFribidi.cmake                        | 34 ++++++++++++++++++++
 cmake/admCheckFridibi.cmake                        | 36 ----------------------
 4 files changed, 43 insertions(+), 45 deletions(-)
 create mode 100644 cmake/admCheckFribidi.cmake
 delete mode 100644 cmake/admCheckFridibi.cmake

diff --git a/avidemux_plugins/ADM_videoFilters6/ass/ADM_libass/CMakeLists.txt b/avidemux_plugins/ADM_videoFilters6/ass/ADM_libass/CMakeLists.txt
index 764d327d3..3c811bd66 100644
--- a/avidemux_plugins/ADM_videoFilters6/ass/ADM_libass/CMakeLists.txt
+++ b/avidemux_plugins/ADM_videoFilters6/ass/ADM_libass/CMakeLists.txt
@@ -36,7 +36,7 @@ ${Asm}
 ADD_DEFINITIONS(" -std=gnu99 ")
 #
 ADD_LIBRARY(${ADM_LIB} STATIC ${${ADM_LIB}_SRCS})
-ADD_DEFINITIONS(${FREETYPE2_CFLAGS} ${FRIDIBI_CFLAGS})
+ADD_DEFINITIONS(${FREETYPE2_CFLAGS} ${FRIBIDI_CFLAGS})
 INCLUDE_DIRECTORIES(${LIBICONV_INCLUDE_DIR})
 
 IF (FONTCONFIG_FOUND)
diff --git a/avidemux_plugins/ADM_videoFilters6/ass/CMakeLists.txt b/avidemux_plugins/ADM_videoFilters6/ass/CMakeLists.txt
index e72735996..6299a071e 100644
--- a/avidemux_plugins/ADM_videoFilters6/ass/CMakeLists.txt
+++ b/avidemux_plugins/ADM_videoFilters6/ass/CMakeLists.txt
@@ -1,10 +1,10 @@
 INCLUDE(admCheckFreeType)
-INCLUDE(admCheckFridibi)
+INCLUDE(admCheckFribidi)
 ADD_CORE_INCLUDE(ADM_coreSubtitles)
 checkFreeType()
-checkFridibi("0.19")
+checkFribidi("0.19")
 
-IF (USE_FREETYPE AND USE_FRIDIBI)
+IF (USE_FREETYPE AND USE_FRIBIDI)
     INCLUDE(vf_plugin)
     SET(ADM_vf_ssa_SRCS ADM_vidASS.cpp)
 
@@ -13,10 +13,10 @@ IF (USE_FREETYPE AND USE_FRIDIBI)
     IF(DO_COMMON)
         IF(USE_EXTERNAL_LIBASS)
             ADD_DEFINITIONS("-DUSE_EXTERNAL_LIBASS")
-            TARGET_LINK_LIBRARIES(ADM_vf_ssa ${LIBASS_LIBRARIES} ${FREETYPE2_LDFLAGS} ${FRIDIBI_LDFLAGS} ADM_coreSubtitle)
+            TARGET_LINK_LIBRARIES(ADM_vf_ssa ${LIBASS_LIBRARIES} ${FREETYPE2_LDFLAGS} ${FRIBIDI_LDFLAGS} ADM_coreSubtitle)
         ELSE(USE_EXTERNAL_LIBASS)
             ADD_SUBDIRECTORY(ADM_libass)
-            TARGET_LINK_LIBRARIES(ADM_vf_ssa ADM_libass ${FREETYPE2_LDFLAGS} ${FRIDIBI_LDFLAGS} ADM_coreSubtitle)
+            TARGET_LINK_LIBRARIES(ADM_vf_ssa ADM_libass ${FREETYPE2_LDFLAGS} ${FRIBIDI_LDFLAGS} ADM_coreSubtitle)
         ENDIF(USE_EXTERNAL_LIBASS)
         # We force the use of fontconfig
         ADD_DEFINITIONS("-DUSE_FONTCONFIG")
@@ -25,6 +25,6 @@ IF (USE_FREETYPE AND USE_FRIDIBI)
 
     INIT_VIDEO_FILTER(ADM_vf_ssa)
     INSTALL_VIDEO_FILTER(ADM_vf_ssa)
-ELSE (USE_FREETYPE AND USE_FRIDIBI)
-        MESSAGE(STATUS "Fribidi or feetype missing, skipping filter")
-ENDIF (USE_FREETYPE AND USE_FRIDIBI)
+ELSE (USE_FREETYPE AND USE_FRIBIDI)
+    MESSAGE(STATUS "Fribidi or feetype missing, skipping filter")
+ENDIF (USE_FREETYPE AND USE_FRIBIDI)
diff --git a/cmake/admCheckFribidi.cmake b/cmake/admCheckFribidi.cmake
new file mode 100644
index 000000000..e9de2f6e2
--- /dev/null
+++ b/cmake/admCheckFribidi.cmake
@@ -0,0 +1,34 @@
+include(admCheckFontConfig)
+MACRO(checkFribidi minVersion)
+########################################
+# FRIBIDI
+########################################
+OPTION(FRIBIDI "" ON)
+checkFontConfig()
+MESSAGE(STATUS "Checking for Fribidi (want ${minVersion})")
+MESSAGE(STATUS "**************************************")
+
+IF(HAVE_FONTCONFIG)
+    IF (FRIBIDI)
+        PKG_CHECK_MODULES(FRIBIDI fribidi)
+        PRINT_LIBRARY_INFO("Fribidi" FRIBIDI_FOUND "${FRIBIDI_CFLAGS}" "${FRIBIDI_LDFLAGS}")
+        IF (FRIBIDI_FOUND)
+            MESSAGE(STATUS "Fribidi version ${FRIBIDI_VERSION}")
+                IF(("${FRIBIDI_VERSION}" VERSION_GREATER "${minVersion}.*") OR ("${FRIBIDI_VERSION}" VERSION_EQUAL "${minVersion}.*"))
+                    SET(USE_FRIBIDI 1)
+                ELSE(("${FRIBIDI_VERSION}" VERSION_GREATER "${minVersion}.*") OR ("${FRIBIDI_VERSION}" VERSION_EQUAL "${minVersion}.*"))
+                    MESSAGE(STATUS "Your version of fribidi is too old, we need at least ${minVersion}.*")
+                ENDIF(("${FRIBIDI_VERSION}" VERSION_GREATER "${minVersion}.*") OR ("${FRIBIDI_VERSION}" VERSION_EQUAL "${minVersion}.*"))
+        ENDIF (FRIBIDI_FOUND)
+    ELSE (FRIBIDI)
+        MESSAGE("${MSG_DISABLE_OPTION}")
+    ENDIF (FRIBIDI)
+ELSE(HAVE_FONTCONFIG)
+    MESSAGE(STATUS "No fontconfig => no fribidi...")
+ENDIF(HAVE_FONTCONFIG)
+
+APPEND_SUMMARY_LIST("Miscellaneous" "FRIBIDI" "${USE_FRIBIDI}")
+
+MESSAGE("")
+
+ENDMACRO(checkFribidi)
diff --git a/cmake/admCheckFridibi.cmake b/cmake/admCheckFridibi.cmake
deleted file mode 100644
index 79ee06e54..000000000
--- a/cmake/admCheckFridibi.cmake
+++ /dev/null
@@ -1,36 +0,0 @@
-include(admCheckFontConfig)
-MACRO(checkFridibi minVersion)
-########################################
-# FRIDIBI
-########################################
-OPTION(FRIDIBI "" ON)
-checkFontConfig()
-MESSAGE(STATUS "Checking for Fridibi (want ${minVersion})")
-MESSAGE(STATUS "**************************************")
-
-IF(HAVE_FONTCONFIG)
-
-        IF (FRIDIBI)
-	        PKG_CHECK_MODULES(FRIDIBI fribidi)
-	        PRINT_LIBRARY_INFO("Fribidi" FRIDIBI_FOUND "${FRIDIBI_CFLAGS}" "${FRIDIBI_LDFLAGS}")
-	        IF (FRIDIBI_FOUND)
-		        # Warning does not work if we ask 0.19 and get 0.20
-		        MESSAGE(STATUS "Fridibi version ${FRIDIBI_VERSION}")
-		        IF("${FRIDIBI_VERSION}" MATCHES "${minVersion}.*")
-			        SET(USE_FRIDIBI 1)
-		        ELSE("${FRIDIBI_VERSION}" MATCHES "${minVersion}.*")
-			        MESSAGE(STATUS "Your version of cmake is too old, we need  ${minVersion}.*")
-		        ENDIF("${FRIDIBI_VERSION}" MATCHES "${minVersion}.*")
-	        ENDIF (FRIDIBI_FOUND)
-        ELSE (FRIDIBI)
-	        MESSAGE("${MSG_DISABLE_OPTION}")
-        ENDIF (FRIDIBI)
-ELSE(HAVE_FONTCONFIG)
-        MESSAGE(STATUS "No fontconfig=> no fribidi....")
-ENDIF(HAVE_FONTCONFIG)
-
-APPEND_SUMMARY_LIST("Miscellaneous" "FRIBIDI" "${FRIDIBI_FOUND}")
-
-MESSAGE("")
-
-ENDMACRO(checkFridibi)
